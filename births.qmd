---
editor_options: 
  chunk_output_type: console
editor:
  markdown:
    canonical: true  
---

# Births

Compare sources of births data.
Construct birth estimates.

## Setup
```{r}
#| label: setup

source(here::here("setup.R"))
```


```{r}
#| label: constants

mage_order <- c(
  "<15",
  "15-17",
  "18-19",
  "20-24",
  "25-29",
  "30-34",
  "35-39",
  "40-44",
  "45+",
  "Unknown",
  "Total"
)

```

## Get and smooth Census data on births

```{r}

df <- readRDS(fs::path(DWORK, "cocwide.rds"))
glimpse(df)


```

### Explore Census births data

The checks below show that Census calculates birth rates as births / (avg pop of current and prior year) * 1000.
For example, birth rate in 2018 = births in 2018 / avg pop of 2018 and 2017, x 1000.

```{r}
cnty <- "Westchester" # Albany Saratoga Washington Westchester
check <- df |>
  filter(
    stfips == "36",
    # cntyfips == "115",
    shortname == cnty,
    year %in% 2012:2018,
    # str_detect(variable, "birth") | variable == "pop"
  ) |>
  select(shortname, year, pop, poplag, births, rbirths) |>
  mutate(avgpop = (pop + poplag) / 2, crbirths = births / avgpop * 1000) |>
  relocate(avgpop, .after = poplag)

check |>
  knitr::kable()


```

### Interpolate and adjust Census births data

```{r}

# calculate improved births for decennial census years
df2 <- df

```