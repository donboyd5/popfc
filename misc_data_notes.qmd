---
editor_options: 
  chunk_output_type: console
editor:
  markdown:
    canonical: true  
---



## NYS DOH New York State Population Data: Beginning 2003 -- age group, gender, race/ethnicity counties by year

https://health.data.ny.gov/Health/New-York-State-Population-Data-Beginning-2003/e9uj-s3sf/about_data
https://www.health.ny.gov/statistics/vital_statistics/

> Population data file is provided as an additional reference file when
> interpreting vital statistics death rates. The population data is
> derived from the corresponding release of the NCHS annual estimates of
> "Bridged Race Vintage" which are consistent with the Bureau of the
> Census estimates from "Vintage" (released in the summer). For more
> information, check out:
> http://www.health.ny.gov/statistics/vital_statistics/. The "About" tab
> contains additional details concerning this dataset.


```{r}
#| label: setup

source(here::here("setup.R"))
```


```{r}
#| label: nysdoh
#| eval: false

fname <- "New_York_State_Population_Data__Beginning_2003_20250419.csv"
fpath <- fs::path(dnysdoh, fname)

df <- vroom(fpath, col_types = cols(.default = col_character()))
glimpse(df)
Hmisc::describe(df)
skim(df)


df1 <- df |>
  select(
    year = 1,
    fagegroup = 2,
    agegroup = 3,
    fgender = 4,
    gender = 5,
    frethnic = 6,
    rethnic = 7,
    cocode = 8,
    area = 9,
    pop = 10
  ) |>
  mutate(
    across(c(year, fagegroup, fgender, frethnic), as.integer),
    pop = as.numeric(pop)
  )
summary(df1)
count(df1, fagegroup, agegroup) # changes
count(df1 |> filter(year == max(year)), fagegroup, agegroup) # changes
count(df1, fgender, gender) # good 0 is total
count(df1, frethnic, rethnic) # good 0 is total
tmp <- count(df1, cocode, area) # Washington is 61

# put latest age codes on the data
agecodes <- df1 |>
  filter(year == max(year)) |>
  select(fagegroup, agegroup) |>
  distinct() |>
  arrange(fagegroup)
agecodes


df2 <- df1 |>
  select(-agegroup) |>
  left_join(agecodes, by = join_by(fagegroup))

df2 |>
  filter(cocode == "61", fgender == 0, frethnic == 0) |>
  mutate(pct = pop / pop[fagegroup == 0], .by = c(year, cocode)) |>
  filter(fagegroup != 0) |>
  ggplot(aes(year, pct, colour = agegroup)) +
  geom_line() +
  geom_point()

# fct_collapse(gss_cat$partyid,
#   missing = c("No answer", "Don't know"),
#   other = "Other party",
#   rep = c("Strong republican", "Not str republican"),
#   ind = c("Ind,near rep", "Independent", "Ind,near dem"),
#   dem = c("Not str democrat", "Strong democrat")

df3 <- df2 |>
  filter(cocode == "61", fgender == 0, frethnic == 0) |>
  mutate(pct = pop / pop[fagegroup == 0], .by = c(year, cocode)) |>
  filter(fagegroup != 0) |>
  mutate(
    fagegroup = as.factor(fagegroup),
    agegroup2 = fct_collapse(
      fagegroup,
      age_00_19 = 1:3,
      age_20_34 = 4:5,
      age_35_44 = 6,
      age_45_54 = 7,
      age_55_64 = 8,
      age_65_74 = 9,
      age_75_99 = 10:11
    )
  ) |>
  summarise(pct = sum(pct), .by = c(year, cocode, area, agegroup2))

df3 |>
  ggplot(aes(year, pct, colour = agegroup2)) +
  geom_line() +
  geom_point() +
  scale_y_continuous(limits = c(0, NA_real_), breaks = seq(0, 30, .02))


```

## Local Area Unemployment Statistics: Beginning 1990 (data documentation says 1976)

https://data.ny.gov/Economic-Development/County-Employment-Data/4v74-29eq/about_data

Needs seasonal adjustment

```{r}
#| label: laus
#| eval: false

url <- "https://data.ny.gov/api/odata/v4/4v74-29eq"
url <- "https://data.ny.gov/d/4v74-29eq"

# discovered by going to export / api endpoint and experimenting

# https://support.socrata.com/hc/en-us/articles/202949268-How-to-query-more-than-1000-rows-of-a-dataset
# limit of 50k recs per query
limit <- 50000 # 50k max; LAUS has about 26k records now, so no problem
url <- paste0("https://data.ny.gov/resource/4v74-29eq.csv?$limit=", limit) # all fields will be character with quotes, that's ok
fname_base <- "County_Employment_Data_"
fname <- paste0(fname_base, today(), ".csv")
fpath <- fs::path(dnysdol, fname)
download.file(url, fpath, mode = "wb")

# fname <- "County_Employment_Data_20250419.csv"
# fpath <- fs::path(dnysdol, fname)

df <- vroom(
  fpath,
  skip = 1,
  col_names = c("area", "year", "month", "lf", "emp", "unemp", "ur"),
  col_types = "ciinnnn"
)
glimpse(df)
summary(df)

areas <- count(df, area) # just the 62 counties

df1 <- df |>
  mutate(
    date = as.Date(paste0(year, "-", month, "-1")),
    area = str_remove(area, " County")
  )
count(df1, date)
summary(df1) # through Feb 2025

counties <- c("Saratoga", "Warren", "Washington")
df1 |>
  filter(area %in% counties) |>
  filter(year(date) >= 2022) |>
  ggplot(aes(date, ur, colour = area)) +
  geom_line() +
  geom_point()

df1 |>
  filter(area %in% counties) |>
  filter(year(date) >= 2022) |>
  ggplot(aes(date, lf)) +
  geom_line() +
  geom_point() +
  facet_wrap(~area, scales = "free_y")

```

## QCEW

```{r}
#| label: qcew
#| eval: false

# https://statistics.labor.ny.gov/qcew.zip

```

## Occupational and industry projections NYSDOL

https://dol.ny.gov/long-term-occupational-projections
https://data.ny.gov/Economic-Development/Long-Term-Occupational-Projections/pqm4-9qqb/about_data
https://data.ny.gov/Economic-Development/Long-term-Industry-Projections/b7d6-zygf/about_data

```{r}
#| label: nysdol-occind-proj
#| eval: false

# https://dol.ny.gov/long-term-occupational-projections
# https://data.ny.gov/Economic-Development/Long-Term-Occupational-Projections/pqm4-9qqb/about_data
# https://data.ny.gov/Economic-Development/Long-term-Industry-Projections/b7d6-zygf/about_data

```